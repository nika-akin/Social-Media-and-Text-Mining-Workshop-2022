<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Text mining with Twitter data - 2&nbsp; Use case Twitter text mining</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./summary.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Use case Twitter text mining</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Text mining with Twitter data</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Use case Twitter text mining</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#required-rpackages" id="toc-required-rpackages" class="nav-link active" data-scroll-target="#required-rpackages">Required <code>R</code>packages</a></li>
  <li><a href="#overview-of-observations" id="toc-overview-of-observations" class="nav-link" data-scroll-target="#overview-of-observations"><span class="header-section-number">2.0.1</span> Overview of observations</a></li>
  <li><a href="#predicting-depression-tweets-based-on-followers-and-friends" id="toc-predicting-depression-tweets-based-on-followers-and-friends" class="nav-link" data-scroll-target="#predicting-depression-tweets-based-on-followers-and-friends"><span class="header-section-number">3</span> Predicting depression tweets based on followers and friends</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Use case Twitter text mining</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="required-rpackages" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="required-rpackages">Required <code>R</code>packages</h3>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"kaggler"</span>, <span class="st">"tidyverse"</span>, <span class="st">"httr"</span>, <span class="st">"readr"</span>, <span class="st">"here"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">pkgs</span>, <span class="va">require</span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#else install kaggler:</span></span>
<span><span class="co">#install.packages(c("devtools"))</span></span>
<span><span class="co">#devtools::install_github("ldurazo/kaggler")</span></span>
<span></span>
<span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span> <span class="co"># to resolve namespace conflicts between tidyverse and dplyr</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cjbarrie/academictwitteR">academictwitteR</a></span><span class="op">)</span>    <span class="co"># collecting Twitter data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>              <span class="co"># Data Wrangling, pre-processing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://quanteda.io">quanteda</a></span><span class="op">)</span>           <span class="co"># text-based descriptive</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://quanteda.io">quanteda.textstats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">quanteda.textplots</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/tidytext">tidytext</a></span><span class="op">)</span>           <span class="co"># Text Mining 'tidy format'</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trinker/textclean">textclean</a></span><span class="op">)</span>          <span class="co"># Pre-Processing + harmonizing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>          <span class="co"># Wrangling with time series data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dirk.eddelbuettel.com/code/anytime.html">anytime</a></span><span class="op">)</span>            <span class="co"># parsing dates</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="descriptive-overview" class="level4"><h4 class="anchored" data-anchor-id="descriptive-overview">Descriptive Overview</h4>
<p>For demonstration purposes we retrieve an archived Twitter (sub-)sample, containing English <strong>depression</strong> specific tweets. (The sample contains <em>N</em> = 20,000 tweets.) We retrieve a sub-sample from the platform <em>Kaggle</em>.</p>
<p><strong>a.)</strong> This can be directly downloaded: <a href="https://www.kaggle.com/datasets/infamouscoder/mental-health-social-media?select=Mental-Health-Twitter.csv"><strong>Kaggle Data Dump, Depression‚Äù</strong></a></p>
<p><strong>b.)</strong> Or by issuing a <code>GET</code> request via its <code>API</code> (see below).</p>
<p>For obtaining the data via the <code>Kaggle API</code> we <em>install</em> and <em>load</em> all dependencies to use <code>kaggler</code>.</p>
<p><em>Note</em>. For both (a &amp; b authentication is required)</p>
<p>A <code>kaggle.json</code> file needs to be made for <strong>authentication</strong> on Kaggle. The <code>kaggle.json</code> file should be positioned within the working directory. The json contains: <em>username</em> and the <code>API token</code>.</p>
<p>To create your <code>API token</code> go to your Kaggle Profil: (Your profile &gt; Account &gt; Settings &gt; API &gt; Create new token)</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">"C:/Users/batzdova/Desktop"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/i_am.html">i_am</a></span><span class="op">(</span><span class="st">"kaggle.json"</span><span class="op">)</span></span>
<span><span class="fu">kgl_auth</span><span class="op">(</span>creds_file <span class="op">=</span> <span class="st">'kaggle.json'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu">kgl_datasets_download_all</span><span class="op">(</span>owner_dataset <span class="op">=</span> <span class="st">"infamouscoder/mental-health-social-media?select=Mental-Health-Twitter"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/">httr</a></span><span class="op">)</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="st">"https://www.kaggle.com/datasets/infamouscoder/mental-health-social-media?select=Mental-Health-Twitter.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">url</span>,<span class="va">temp</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">unz</a></span><span class="op">(</span><span class="va">temp</span>, <span class="st">"Mental-Health-Twitter.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mental</span> <span class="op">&lt;-</span> <span class="va">data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or alternatively, read in csv-data which have been downloaded.</p>
</section></section><section id="overview-of-observations" class="level3" data-number="2.0.1"><h3 data-number="2.0.1" class="anchored" data-anchor-id="overview-of-observations">
<span class="header-section-number">2.0.1</span> Overview of observations</h3>
<p>Our data set comprises <span class="math inline">\(20,000\)</span> observations with <span class="math inline">\(10,000\)</span> depression labeled tweets. Yet, only <span class="math inline">\(19,881\)</span> are unique tweets (i.e.&nbsp;<code>post_id</code>)</p>
<p>Each observed person <code>user_id</code> (<span class="math inline">\(N=72\)</span> ) can be characterized by a set of variables (i.e., <em>features</em>) such as date of post creating <code>post_created</code> or count of <code>followers</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">mental</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 20,000
Columns: 11
$ ...1         &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,~
$ post_id      &lt;dbl&gt; 6.378947e+17, 6.378904e+17, 6.377493e+17, 6.3~
$ post_created &lt;chr&gt; "Sun Aug 30 07:48:37 +0000 2015", "Sun Aug 30~
$ post_text    &lt;chr&gt; "It's just over 2 years since I was diagnosed~
$ user_id      &lt;dbl&gt; 1013187241, 1013187241, 1013187241, 101318724~
$ followers    &lt;dbl&gt; 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 8~
$ friends      &lt;dbl&gt; 211, 211, 211, 211, 211, 211, 211, 211, 211, ~
$ favourites   &lt;dbl&gt; 251, 251, 251, 251, 251, 251, 251, 251, 251, ~
$ statuses     &lt;dbl&gt; 837, 837, 837, 837, 837, 837, 837, 837, 837, ~
$ retweets     &lt;dbl&gt; 0, 1, 0, 2, 1, 1, 1, 0, 0, 41, 1, 0, 0, 0, 0,~
$ label        &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ~</code></pre>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">label</span> <span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 1
      n
  &lt;int&gt;
1 10000</code></pre>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">post_id</span><span class="op">)</span> <span class="co"># count of unique tweets</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19881</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">user_id</span><span class="op">)</span> <span class="co"># count of unique users</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 72</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>no_mentions <span class="op">=</span> <span class="fu">str_remove_all</span><span class="op">(</span>string <span class="op">=</span> <span class="va">post_text</span>, pattern <span class="op">=</span> <span class="st">"[@][\\w_-]+"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">post_text</span>, <span class="va">no_mentions</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Parse Date Variable</strong> <code>post_created</code></p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove the timezone offset from the date string</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" \\+\\d{4}"</span>, <span class="st">""</span>, <span class="va">mental</span><span class="op">$</span><span class="va">post_created</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Convert the date string to a date variable</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">date_any</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/anytime/man/anytime.html">anytime</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Format the date variable as "YYYY-MM-DD H:M"</span></span>
<span><span class="co">#mental$formatted_date &lt;- format(mental$date_any , "%Y-%m-%d %H:%M")</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">formatted_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">date_any</span> , <span class="st">"%Y-%m-%d"</span><span class="op">)</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">day_hour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">date_any</span>, <span class="st">"%Y-%m-%d %H"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Formatted_date</code> is a <code>character</code> class. When we would use <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> we would lose the <code>timestamp</code> information. When we have a character with both date and time we have to use <code>POSIXct</code> class (as seen with the <code>date_any</code> variable).</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mental</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">formatted_date</span><span class="op">)</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">date_hour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">day_hour</span><span class="op">)</span></span>
<span><span class="co">#mental$formatted_date_time &lt;- as.POSIXlt(mental$formatted_date)</span></span>
<span></span>
<span></span>
<span><span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span><span class="co"># calculate how many tweets posted on each date</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span><span class="co"># plot the result</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"7 day"</span>, date_labels <span class="op">=</span> <span class="st">"%b %d"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Number of Tweets\n"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"\nDate"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p><strong>Distribution Friends</strong></p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mental</span><span class="op">$</span><span class="va">logfriends</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">friends</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">logfriends</span>,  breaks <span class="op">=</span> <span class="fl">50</span>, prob<span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">logfriends</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p><strong>Distribution Followers</strong></p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mental</span><span class="op">$</span><span class="va">logfollow</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">followers</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">logfollow</span>, breaks <span class="op">=</span> <span class="fl">50</span>, prob <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">logfollow</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/Log transformed followers-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mental</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">logfriends</span>, y <span class="op">=</span> <span class="va">logfollow</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p><strong>Tweets und Retweets per day</strong></p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">twt_retwt_summary</span> <span class="op">&lt;-</span> <span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">user_id</span>, <span class="va">date</span>, <span class="va">label</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>tweets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            avg_retweets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">retweets</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">startTime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-01-01"</span><span class="op">)</span></span>
<span><span class="va">endTime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2017-10-31"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a start and end time R object</span></span>
<span><span class="va">start.end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">startTime</span>,<span class="va">endTime</span><span class="op">)</span></span>
<span><span class="va">start.end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2014-01-01" "2017-10-31"</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pl1</span> <span class="op">&lt;-</span> <span class="va">twt_retwt_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">tweets</span>, group <span class="op">=</span> <span class="va">user_id</span>, fill<span class="op">=</span> <span class="va">user_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span> size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of depression tweets per day"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">start.end</span>,</span>
<span>                             breaks<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/date_breaks.html">date_breaks</a></span><span class="op">(</span><span class="st">"3 month"</span><span class="op">)</span>,</span>
<span>                             labels<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/date_format.html">date_format</a></span><span class="op">(</span><span class="st">"%b %y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">twt_retwt_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">tweets</span>, group <span class="op">=</span> <span class="va">user_id</span>, fill<span class="op">=</span> <span class="va">label</span>, col<span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span> size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of depression tweets per day"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">start.end</span>,</span>
<span>                             breaks<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/date_breaks.html">date_breaks</a></span><span class="op">(</span><span class="st">"3 month"</span><span class="op">)</span>,</span>
<span>                             labels<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/date_format.html">date_format</a></span><span class="op">(</span><span class="st">"%b %y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">twt_retwt_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">avg_retweets</span>, group <span class="op">=</span> <span class="va">user_id</span>, fill<span class="op">=</span> <span class="va">label</span>, col<span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span> size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of depression tweets per day"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">start.end</span>,</span>
<span>                             breaks<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/date_breaks.html">date_breaks</a></span><span class="op">(</span><span class="st">"3 month"</span><span class="op">)</span>,</span>
<span>                             labels<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/date_format.html">date_format</a></span><span class="op">(</span><span class="st">"%b %y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pl2</span> <span class="op">&lt;-</span><span class="va">twt_retwt_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">avg_retweets</span>, group<span class="op">=</span><span class="va">user_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span> size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Average (geometric mean) retweets each day"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>limits<span class="op">=</span><span class="va">start.end</span>,</span>
<span>                             breaks<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/date_breaks.html">date_breaks</a></span><span class="op">(</span><span class="st">"3 month"</span><span class="op">)</span>,</span>
<span>                             labels<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/date_format.html">date_format</a></span><span class="op">(</span><span class="st">"%b %y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">pl1</span>,<span class="va">pl2</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/ts.plot.html">ts.plot</a></span><span class="op">(</span><span class="va">twt_retwt_summary</span><span class="op">$</span><span class="va">tweets</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/ts.plot.html">ts.plot</a></span><span class="op">(</span><span class="va">twt_retwt_summary</span><span class="op">$</span><span class="va">avg_retweets</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p><strong>User Activity</strong></p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">user_id</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>username <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">user_id</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">username</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Retweet activity per user</span></span>
<span><span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">retweets</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">user_id</span>, <span class="va">post_text</span>, <span class="va">retweets</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,000 x 3
      user_id post_text                                     retweets
        &lt;dbl&gt; &lt;chr&gt;                                            &lt;dbl&gt;
 1  490044008 RT @omgAdamSaleh: We got kicked out of a @De~   839540
 2 3249600438 RT @POTUS: Thank you for everything. My last~   822450
 3 1497350173 RT @POTUS: Thank you for everything. My last~   820245
 4 1306425758 RT @Louis_Tomlinson: Our fans support really~   402946
 5 1497350173 RT @HamillHimself: no words #Devastated http~   358548
 6 3249600438 RT @HamillHimself: no words #Devastated http~   358536
 7  171999132 RT @HamillHimself: no words #Devastated http~   358510
 8 1306425758 RT @Louis_Tomlinson: @NaughtyBoyMusic Jesus ~   341695
 9 1306425758 RT @Louis_Tomlinson: @NaughtyBoyMusic good f~   306473
10  490044008 RT @edsheeran: Hello 2017... https://t.co/1U~   273872
# i 19,990 more rows</code></pre>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Tweets und Retweets per User</span></span>
<span><span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">user_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>tweets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            retweetnr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">retweets</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">tweets</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">retweetnr</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 x 3
      user_id tweets retweetnr
        &lt;dbl&gt;  &lt;int&gt;     &lt;dbl&gt;
 1 1497350173    792   7004039
 2  490044008   2117   5379581
 3 1306425758    306   4810463
 4 3045320288    633   4402064
 5 3249600438   1504   4131286
 6  324294391    215    765268
 7  171999132    121    463537
 8   18831261    543    317468
 9   49548465    352    197019
10 1015648590     84    175150
# i 62 more rows</code></pre>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Proportion Likes and Retweets per User</span></span>
<span><span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">user_id</span>, <span class="va">post_text</span>, <span class="va">retweets</span>, <span class="va">favourites</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="op">(</span><span class="va">favourites</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">retweets</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># to avoid zero</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,000 x 5
      user_id post_text                    retweets favourites ratio
        &lt;dbl&gt; &lt;chr&gt;                           &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1 2660477449 "@BenBuckwalter i was diagn~        0      39008 39009
 2 2660477449 "@JordanSweeto i hope whate~        0      39008 39009
 3 2660477449 "@BenBuckwalter i would!"           0      39008 39009
 4 2660477449 "@BenBuckwalter i feel like~        0      39008 39009
 5 2660477449 "@BryanStars I love you,  y~        0      39008 39009
 6 2660477449 "@BenBuckwalter me! I volun~        0      39008 39009
 7 2660477449 "I'm getting tired of your ~        0      39008 39009
 8 2660477449 "@deefizzy you're amazing. ~        0      39008 39009
 9 2660477449 "@BenBuckwalter people tend~        0      39008 39009
10 2660477449 "@BenBuckwalter being notic~        0      39008 39009
# i 19,990 more rows</code></pre>
</div>
</div>
<section id="basics-text-mining-in-a-nutshell" class="level4"><h4 class="anchored" data-anchor-id="basics-text-mining-in-a-nutshell">8. Basics Text Mining in a Nutshell</h4>
<p>A.<strong>Document</strong> = collection of strings and their metadata</p>
<p>B.<strong>Corpus</strong> = collection of *documents**.</p>
<p>C.<strong>Tokens</strong> = smallest unit of meaning (mostly words)</p>
<p>D.<strong>Vocabulary</strong> = collection of unique words of a <em>Corpus</em>.</p>
<p>E.<strong>D</strong>ocument-<strong>F</strong>eature-<strong>M</strong>atrix or <strong>D</strong>ocument-<strong>T</strong>erm-<strong>M</strong>atrix =</p>
<p>this is a matrix where the rows indicate the documents, the columns indicate the expressions and the cells indicate the frequency of the expressions in each document, i.e.: Matrix with <em>n</em> = number of Document rows and <em>m</em> = size of Vocabulary columns, based on <strong>bag-of-words</strong> assumption, which ignores word order and syntax.</p>
<section id="pre-processing" class="level5"><h5 class="anchored" data-anchor-id="pre-processing">8.1. Pre-processing</h5>
<p>A. <strong>Tokenisation</strong></p>
<p>B. <strong>Remove</strong> Stopwords</p>
<p>C. <strong>String</strong> operations (punctuation, normalise URL).</p>
<p>The order of the application steps is crucial and should be guided by the research question.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Clean @-Symbol</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">post_text</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"@\\w+"</span>, <span class="st">""</span>, <span class="va">mental</span><span class="op">$</span><span class="va">post_text</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean Interpunction</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">post_text</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[[:punct:]]"</span>, <span class="st">""</span>, <span class="va">mental</span><span class="op">$</span><span class="va">post_text</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean Numbers</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">post_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[[:digit:]]"</span>, <span class="st">""</span>, <span class="va">mental</span><span class="op">$</span><span class="va">post_text</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean pictures</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">post_text</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"pictwitter\\w+ *"</span>, <span class="st">""</span>, <span class="va">mental</span><span class="op">$</span><span class="va">post_text</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Clean HTML-Notation</span></span>
<span><span class="va">remove_html</span> <span class="op">&lt;-</span> <span class="st">"&amp;amp;|&amp;lt;|&amp;gt;"</span> <span class="co">#&amp;lt und &amp;gt stehen f√ºr &lt; und &gt; und &amp;amp f√ºr &amp;</span> &amp;</span>
<span></span>
<span><span class="va">mental_en</span> <span class="op">&lt;-</span> <span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">post_id</span>, <span class="va">post_text</span>, <span class="va">user_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">post_text</span>, <span class="va">remove_html</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With <a href="https://github.com/trinker/textclean"><code>textclean</code></a> further harmonisation can be done, e.g.&nbsp;replacing emojis with word equivalents.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mental_en</span><span class="op">$</span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/textclean/man/replace_emoji.html">replace_emoji</a></span><span class="op">(</span><span class="va">mental_en</span><span class="op">$</span><span class="va">text</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or normalizing colloquial expressions such as word elongations (e.g., ‚ÄúWhyyyy‚Äù)</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mental_en</span><span class="op">$</span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/textclean/man/replace_word_elongation.html">replace_word_elongation</a></span><span class="op">(</span><span class="va">mental_en</span><span class="op">$</span><span class="va">text</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the data frame, you can create a <em>Corpus</em> object, i.e.&nbsp;a collection of <em>documents</em> (tweets) and their <em>metadata</em>.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#select unique tweet_ids</span></span>
<span><span class="va">unique</span> <span class="op">&lt;-</span> <span class="va">mental_en</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">post_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets_en_corpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/corpus.html">corpus</a></span><span class="op">(</span><span class="va">unique</span>,</span>
<span>                           docid_field <span class="op">=</span> <span class="st">"post_id"</span>,</span>
<span>                           text_field <span class="op">=</span> <span class="st">"post_text"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <code>quanteda</code> the smallest meaningful unit are <strong>tokens</strong> which can be generated by segmenting into words (see <code>tidytext</code> <code>unnest_tokens(word, text)</code>. Further, we can remove <strong>stopwords</strong> (hedges, grammatical signifiers which bear little semantic meaning). See (<code><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html">stopwords()</a></code>)</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets_en_tokens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/tokens.html">tokens</a></span><span class="op">(</span><span class="va">tweets_en_corpus</span>,</span>
<span>                           remove_punct <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           remove_numbers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           remove_symbols <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           remove_url <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://quanteda.io/reference/tokens_tolower.html">tokens_tolower</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://quanteda.io/reference/tokens_select.html">tokens_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html">stopwords</a></span><span class="op">(</span><span class="st">"english"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kw_depression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://quanteda.io/reference/kwic.html">kwic</a></span><span class="op">(</span><span class="va">tweets_en_tokens</span>, pattern <span class="op">=</span>  <span class="st">"depress*"</span>, window <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">kw_depression</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="tidy-workflowexploration-tweets-retweets-and-hashtags" class="level4"><h4 class="anchored" data-anchor-id="tidy-workflowexploration-tweets-retweets-and-hashtags">8.2. Tidy Workflow‚ÄìExploration Tweets, Retweets and Hashtags</h4>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Tokenising Tweets (1-gram) and Pre-processing with tidytext</span></span>
<span></span>
<span><span class="va">tweet_words</span> <span class="op">&lt;-</span> <span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">user_id</span>, </span>
<span>         <span class="va">post_text</span>, </span>
<span>         <span class="va">retweets</span>, </span>
<span>         <span class="va">favourites</span>,</span>
<span>         <span class="va">formatted_date</span>, </span>
<span>         <span class="va">post_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">post_text</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">stop_words</span>, by <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">word</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"amp"</span>, <span class="st">"de"</span>, <span class="st">"twitter"</span>, <span class="st">"youre"</span>, <span class="st">"en"</span>, <span class="st">"die"</span>, <span class="st">"rt"</span>, <span class="st">"im"</span>, <span class="st">"dont"</span>, <span class="st">"ive"</span>, <span class="st">"yong"</span><span class="op">)</span>,</span>
<span>         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"[a-z]"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tweet_words</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">word</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>word <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Most common words in Tweets on Depression"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Frequency of words"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/Tokenisation und Pre-processing-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Distribution of Favorites</span></span>
<span><span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">favourites</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/Favorites und Retweets-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Mean Retweets and Mean Favorites</span></span>
<span><span class="va">word_summary</span> <span class="op">&lt;-</span> <span class="va">tweet_words</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            avg_retweets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">retweets</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>            avg_favorites <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">favourites</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;=</span> <span class="fl">30</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">avg_retweets</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Tf-idf: signals importance of a word in a corpus selection</span></span>
<span></span>
<span><span class="va">top_word</span> <span class="op">&lt;-</span> <span class="va">tweet_words</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">formatted_date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/bind_tf_idf.html">bind_tf_idf</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">formatted_date</span>, <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">tf_idf</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">formatted_date</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">formatted_date</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tf_idf</span> <span class="op">&lt;-</span> <span class="va">word_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">top_word</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"word"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">avg_retweets</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#Tf-idf of words per hour</span></span>
<span><span class="va">tf_idf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">tf_idf</span>, <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">tf_idf</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">word</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/tf-idf-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Hashtag exploration</span></span>
<span><span class="va">tweet_words</span> <span class="op">&lt;-</span> <span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hashtags <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">post_text</span>, <span class="st">"#[a-zA-Z]"</span><span class="op">)</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">user_id</span>, <span class="va">post_text</span>, <span class="va">retweets</span>, <span class="va">favourites</span>, <span class="va">formatted_date</span> , <span class="va">post_id</span>,</span>
<span>        <span class="va">hashtags</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">post_text</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">stop_words</span>, by <span class="op">=</span> <span class="st">"word"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">word</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"de"</span>, <span class="st">"|"</span><span class="op">)</span>,</span>
<span>         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"[a-z]"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mental</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hashtags <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">post_text</span>, <span class="st">"#[a-zA-Z]"</span><span class="op">)</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hashtags</span> <span class="op">&lt;</span> <span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">user_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>tweets <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            avg_retweets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">retweets</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tweets</span> <span class="op">&gt;=</span> <span class="fl">30</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">avg_retweets</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 55 x 3
   user_id tweets avg_retweets
     &lt;dbl&gt;  &lt;int&gt;        &lt;dbl&gt;
 1 3.05e 9    633       229.  
 2 1.50e 9    792        74.8 
 3 7.40e 7     50        72.4 
 4 1.31e 9    306        59.8 
 5 1.72e 8    121        11.2 
 6 3.09e 7    142        11.1 
 7 3.25e 9   1504         6.85
 8 7.63e17    522         6.79
 9 6.32e 8    144         5.09
10 4.95e 7    352         4.26
# i 45 more rows</code></pre>
</div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweet_word_summary</span> <span class="op">&lt;-</span> <span class="va">tweet_words</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hashtags</span> <span class="op">&lt;</span> <span class="fl">6</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            avg_retweets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">retweets</span><span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>            avg_favorites <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">favourites</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">tweet_word_summary</span> <span class="op">&lt;-</span><span class="va">tweet_word_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;=</span> <span class="fl">100</span>,</span>
<span>         <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"https"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">word</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"amp"</span>, <span class="st">"de"</span>, <span class="st">"twitter"</span>, <span class="st">"youre"</span>, <span class="st">"en"</span>, <span class="st">"die"</span>, <span class="st">"rt"</span>, <span class="st">"im"</span>, <span class="st">"dont"</span>, <span class="st">"ive"</span>, <span class="st">"yong"</span><span class="op">)</span>,</span>
<span>         <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"[a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">avg_retweets</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tweet_word_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;=</span> <span class="fl">100</span>,</span>
<span>         <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"https"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">avg_retweets</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">word</span><span class="op">)</span>, check_overlap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/hashtags-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweet_word_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;=</span> <span class="fl">100</span>,</span>
<span>         <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">word</span>, <span class="st">"https"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">avg_retweets</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>word <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">avg_retweets</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">avg_retweets</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Which words get the most retweets in depression?"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Only words appearing in at least 100 tweets"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Geometric mean of the Number of retweets"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/hashtags-2.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section></section><section id="predicting-depression-tweets-based-on-followers-and-friends" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Predicting depression tweets based on followers and friends</h1>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Data preprocessing</span></span>
<span><span class="co"># Check for missing values</span></span>
<span><span class="va">missing_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">mental</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">missing_values</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">mental</span><span class="op">)</span>  <span class="co"># Remove rows with missing values</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Convert label variable to factor</span></span>
<span><span class="co">#mental$label &lt;- as.factor(mental$label)</span></span>
<span></span>
<span><span class="co"># Standardize the followers and friends variables</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">followers_standardized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">followers</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mental</span><span class="op">$</span><span class="va">friends_standardized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">mental</span><span class="op">$</span><span class="va">friends</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the standardized variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mental</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"followers"</span>, <span class="st">"followers_standardized"</span>, <span class="st">"friends"</span>, <span class="st">"friends_standardized"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 x 4
  followers followers_standardized friends friends_standardized
      &lt;dbl&gt;                  &lt;dbl&gt;   &lt;dbl&gt;                &lt;dbl&gt;
1        84                 -0.430     211               -0.311
2        84                 -0.430     211               -0.311
3        84                 -0.430     211               -0.311
4        84                 -0.430     211               -0.311
5        84                 -0.430     211               -0.311
6        84                 -0.430     211               -0.311</code></pre>
</div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Select variables for analysis</span></span>
<span><span class="va">selected_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"label"</span>, <span class="st">"followers_standardized"</span>, <span class="st">"friends_standardized"</span><span class="op">)</span></span>
<span><span class="va">mental_selected</span> <span class="op">&lt;-</span> <span class="va">mental</span><span class="op">[</span><span class="va">selected_vars</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># Split the dataset into training and testing sets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># Set a seed for reproducibility</span></span>
<span><span class="va">train_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span><span class="va">mental_selected</span><span class="op">$</span><span class="va">label</span>, p <span class="op">=</span> <span class="fl">0.8</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">mental_selected</span><span class="op">[</span><span class="va">train_indices</span>, <span class="op">]</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">mental_selected</span><span class="op">[</span><span class="op">-</span><span class="va">train_indices</span>, <span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">train_data</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">$</span><span class="va">label</span><span class="op">)</span></span>
<span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linear Regression model</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">label</span> <span class="op">~</span> <span class="va">followers_standardized</span> <span class="op">+</span> <span class="va">friends_standardized</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model evaluation</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></span>
<span><span class="va">evaluation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">label</span>, predicted <span class="op">=</span> <span class="va">predictions</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate evaluation metrics</span></span>
<span><span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">evaluation</span><span class="op">$</span><span class="va">actual</span> <span class="op">-</span> <span class="va">evaluation</span><span class="op">$</span><span class="va">predicted</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span></span>
<span><span class="va">r_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">evaluation</span><span class="op">$</span><span class="va">actual</span>, <span class="va">evaluation</span><span class="op">$</span><span class="va">predicted</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># Print evaluation metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Mean Squared Error (MSE):"</span>, <span class="va">rmse</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Squared Error (MSE): 0.4776674 </code></pre>
</div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Root Mean Squared Error (RMSE):"</span>, <span class="va">rmse</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error (RMSE): 0.4776674 </code></pre>
</div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"R-squared value:"</span>, <span class="va">r_squared</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared value: 0.08754619 </code></pre>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Regression coefficients and p-values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = label ~ followers_standardized + friends_standardized, 
    data = train_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.8265 -0.4814 -0.0809  0.4749  1.1280 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             0.499941   0.003789  131.94   &lt;2e-16 ***
followers_standardized -0.286159   0.008359  -34.23   &lt;2e-16 ***
friends_standardized    0.314163   0.008355   37.60   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4793 on 15997 degrees of freedom
Multiple R-squared:  0.08129,   Adjusted R-squared:  0.08117 
F-statistic: 707.7 on 2 and 15997 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dotwhisker</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dotwhisker/man/dwplot.html">dwplot</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">+</span>  </span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Coefficient Estimate"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>               colour <span class="op">=</span> <span class="st">"grey60"</span>,</span>
<span>               linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Predicting Depression Tweets"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>The followers_standardized coefficient (-0.286159) indicates that, on average, a one-standard-deviation increase in the standardized followers variable is associated with a decrease of 0.286159 units in the predicted depression label. The friends_standardized coefficient (0.314163) indicates that, on average, a one-standard-deviation increase in the standardized friends variable is associated with an increase of 0.314163 units in the predicted depression label. All t-values are large (absolute values &gt; 2), indicating that the coefficients are significantly different from zero.</p>
<p>Overall, the regression analysis suggests that both the standardized followers and standardized friends variables have a statistically significant association with the predicted depression label. An increase in the standardized followers is associated with a decrease in the predicted depression label, while an increase in the standardized friends is associated with an increase in the predicted depression label.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit a non-linear regression model</span></span>
<span><span class="va">model_nonlinear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span><span class="va">label</span> <span class="op">~</span> <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">b</span> <span class="op">*</span> <span class="va">followers_standardized</span><span class="op">)</span> <span class="op">+</span> <span class="va">c</span> <span class="op">*</span> <span class="va">friends_standardized</span>,</span>
<span>                       data <span class="op">=</span> <span class="va">train_data</span>,</span>
<span>                       start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span>, c <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_nonlinear</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: label ~ a * exp(b * followers_standardized) + c * friends_standardized

Parameters:
   Estimate Std. Error t value Pr(&gt;|t|)    
a  0.478974   0.004230  113.23   &lt;2e-16 ***
b -0.510885   0.024174  -21.13   &lt;2e-16 ***
c  0.095444   0.003802   25.11   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4864 on 15997 degrees of freedom

Number of iterations to convergence: 17 
Achieved convergence tolerance: 3.114e-07</code></pre>
</div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Predict the label using the non-linear regression model</span></span>
<span><span class="va">test_data</span><span class="op">$</span><span class="va">predicted_nonlinear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_nonlinear</span>, newdata <span class="op">=</span> <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate the non-linear regression model</span></span>
<span><span class="va">mse_nonlinear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span> <span class="op">-</span> <span class="va">test_data</span><span class="op">$</span><span class="va">predicted_nonlinear</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">rmse_nonlinear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mse_nonlinear</span><span class="op">)</span></span>
<span><span class="va">r_squared_nonlinear</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span> <span class="op">-</span> <span class="va">test_data</span><span class="op">$</span><span class="va">predicted_nonlinear</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">label</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print evaluation metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Mean Squared Error (MSE) - Nonlinear Regression:"</span>, <span class="va">mse_nonlinear</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Squared Error (MSE) - Nonlinear Regression: 0.2366316 </code></pre>
</div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Root Mean Squared Error (RMSE) - Nonlinear Regression:"</span>, <span class="va">rmse_nonlinear</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error (RMSE) - Nonlinear Regression: 0.4864479 </code></pre>
</div>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"R-squared value - Nonlinear Regression:"</span>, <span class="va">r_squared_nonlinear</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared value - Nonlinear Regression: 0.05347357 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dotwhisker/man/dwplot.html">dwplot</a></span><span class="op">(</span><span class="va">model_nonlinear</span><span class="op">)</span><span class="op">+</span>  </span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Coefficient Estimate"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>               colour <span class="op">=</span> <span class="st">"grey60"</span>,</span>
<span>               linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Predicting Depression Tweets with a non-linear model"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gam</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'gam' wurde unter R Version 4.1.3 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade n√∂tiges Paket: splines</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade n√∂tiges Paket: foreach</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'foreach'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Die folgenden Objekte sind maskiert von 'package:purrr':

    accumulate, when</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded gam 1.22</code></pre>
</div>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'mgcv' wurde unter R Version 4.1.3 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade n√∂tiges Paket: nlme</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'nlme' wurde unter R Version 4.1.3 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:dplyr':

    collapse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is mgcv 1.8-41. For overview type 'help("mgcv-package")'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'mgcv'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Die folgenden Objekte sind maskiert von 'package:gam':

    gam, gam.control, gam.fit, s</code></pre>
</div>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit a non-linear regression model using GAM</span></span>
<span><span class="va">model_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">label</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">followers_standardized</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">friends_standardized</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preprocess data by removing missing values</span></span>
<span><span class="va">complete_data</span> <span class="op">&lt;-</span> <span class="va">train_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="co"># Visualize the estimated effects of the variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Adjust the layout of the plots if desired</span></span>
<span></span>
<span><span class="co"># Plot the estimated effect of 'followers'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_gam</span>, select <span class="op">=</span> <span class="fl">1</span>, se<span class="op">=</span><span class="cn">TRUE</span>, residuals <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Followers"</span>, ylab <span class="op">=</span> <span class="st">"Effect of Followers on Label"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the estimated effect of 'friends'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_gam</span>, select <span class="op">=</span> <span class="fl">2</span>, se<span class="op">=</span><span class="cn">TRUE</span>, residuals <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Friends"</span>, ylab <span class="op">=</span> <span class="st">"Effect of Friends on Label"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://gavinsimpson.github.io/gratia/">'gratia'</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'gratia' wurde unter R Version 4.1.3 erstellt</code></pre>
</div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot all smooths</span></span>
<span><span class="fu"><a href="https://gavinsimpson.github.io/gratia/reference/draw.html">draw</a></span><span class="op">(</span><span class="va">model_gam</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>Adding partial residuals to the plot of the estimated effects in a GAM model provides a way to assess the goodness of fit and the presence of systematic patterns in the model.</p>
<p>Partial residuals are calculated by subtracting the estimated component of the model (excluding the effect of a specific variable of interest) from the observed response variable. These residuals represent the part of the response variable that is not accounted for by the model for a specific variable.</p>
<p>When partial residuals are added to the plot of the estimated effects, they are typically shown as individual points or a smooth line against the corresponding variable. This allows you to visually inspect the relationship between the variable and the unexplained variation in the response variable, which can help identify any remaining patterns or trends not captured by the model.</p>
<p>By examining the distribution and pattern of the partial residuals, you can assess whether the model captures the underlying structure and if there are any systematic deviations from the model‚Äôs predictions. Systematic patterns in the partial residuals may indicate that the model is misspecified or that there are additional variables or nonlinear relationships that should be considered.</p>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://gavinsimpson.github.io/gratia/reference/draw.html">draw</a></span><span class="op">(</span><span class="va">model_gam</span>, residuals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="summary_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb92" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Use case Twitter text mining</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">### Required `R`packages {.unnumbered}</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, warning = FALSE, results = 'hide'}</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"kaggler"</span>, <span class="st">"tidyverse"</span>, <span class="st">"httr"</span>, <span class="st">"readr"</span>, <span class="st">"here"</span>) </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(pkgs, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co">#else install kaggler:</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(c("devtools"))</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("ldurazo/kaggler")</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>filter <span class="co"># to resolve namespace conflicts between tidyverse and dplyr</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(academictwitteR)    <span class="co"># collecting Twitter data</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)              <span class="co"># Data Wrangling, pre-processing</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)           <span class="co"># text-based descriptive</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textstats)</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)           <span class="co"># Text Mining 'tidy format'</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textclean)          <span class="co"># Pre-Processing + harmonizing</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)          <span class="co"># Wrangling with time series data</span></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(anytime)            <span class="co"># parsing dates</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_light</span>())</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Descriptive Overview</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>For demonstration purposes we retrieve an archived Twitter (sub-)sample, containing English **depression** specific tweets. (The sample contains *N* = 20,000 tweets.) We retrieve a sub-sample from the platform *Kaggle*.</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>**a.)** This can be directly downloaded: [**Kaggle Data Dump, Depression"**](https://www.kaggle.com/datasets/infamouscoder/mental-health-social-media?select=Mental-Health-Twitter.csv)</span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>**b.)** Or by issuing a <span class="in">`GET`</span> request via its <span class="in">`API`</span> (see below).</span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>For obtaining the data via the <span class="in">`Kaggle API`</span> we *install* and *load* all dependencies to use <span class="in">`kaggler`</span>.</span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>*Note*. For both (a &amp; b authentication is required)</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>A <span class="in">`kaggle.json`</span> file needs to be made for **authentication** on Kaggle. The <span class="in">`kaggle.json`</span> file should be positioned within the working directory. The json contains: *username* and the <span class="in">`API token`</span>.</span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a>To create your <span class="in">`API token`</span> go to your Kaggle Profil: (Your profile <span class="sc">\&gt;</span> Account <span class="sc">\&gt;</span> Settings <span class="sc">\&gt;</span> API <span class="sc">\&gt;</span> Create new token)</span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{r demonstration, eval=FALSE, error=FALSE}</span></span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/batzdova/Desktop"</span>)</span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"kaggle.json"</span>)</span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a><span class="fu">kgl_auth</span>(<span class="at">creds_file =</span> <span class="st">'kaggle.json'</span>)</span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">kgl_datasets_download_all</span>(<span class="at">owner_dataset =</span> <span class="st">"infamouscoder/mental-health-social-media?select=Mental-Health-Twitter"</span>)</span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="st">"https://www.kaggle.com/datasets/infamouscoder/mental-health-social-media?select=Mental-Health-Twitter.csv"</span>)</span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(dataset<span class="sc">$</span>url,temp)</span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">unz</span>(temp, <span class="st">"Mental-Health-Twitter.csv"</span>))</span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(temp)</span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a>mental <span class="ot">&lt;-</span> data</span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>Or alternatively, read in csv-data which have been downloaded.</span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE, message=FALSE, echo=FALSE}</span></span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a><span class="co">#|warning=FALSE</span></span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo=FALSE</span></span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/batzdova/Desktop"</span>)</span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"Mental-Health-Twitter.csv"</span>)</span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a>mental <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Mental-Health-Twitter.csv"</span>)</span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overview of observations</span></span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a>Our data set comprises $20,000$ observations with $10,000$ depression labeled tweets. Yet, only $19,881$ are unique tweets (i.e. <span class="in">`post_id`</span>)</span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a>Each observed person <span class="in">`user_id`</span> ($N=72$ ) can be characterized by a set of variables (i.e., *features*) such as date of post creating <span class="in">`post_created`</span> or count of <span class="in">`followers`</span>.</span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(mental)</span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-93"><a href="#cb92-93" aria-hidden="true" tabindex="-1"></a>mental <span class="sc">%&gt;%</span> </span>
<span id="cb92-94"><a href="#cb92-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(label <span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-95"><a href="#cb92-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb92-96"><a href="#cb92-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-97"><a href="#cb92-97" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(mental<span class="sc">$</span>post_id) <span class="co"># count of unique tweets</span></span>
<span id="cb92-98"><a href="#cb92-98" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(mental<span class="sc">$</span>user_id) <span class="co"># count of unique users</span></span>
<span id="cb92-99"><a href="#cb92-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-100"><a href="#cb92-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-101"><a href="#cb92-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-104"><a href="#cb92-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-105"><a href="#cb92-105" aria-hidden="true" tabindex="-1"></a>mental <span class="sc">%&gt;%</span></span>
<span id="cb92-106"><a href="#cb92-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">no_mentions =</span> <span class="fu">str_remove_all</span>(<span class="at">string =</span> post_text, <span class="at">pattern =</span> <span class="st">"[@][</span><span class="sc">\\</span><span class="st">w_-]+"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-107"><a href="#cb92-107" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(post_text, no_mentions) <span class="sc">%&gt;%</span> </span>
<span id="cb92-108"><a href="#cb92-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>()</span>
<span id="cb92-109"><a href="#cb92-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-110"><a href="#cb92-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-111"><a href="#cb92-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-112"><a href="#cb92-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-113"><a href="#cb92-113" aria-hidden="true" tabindex="-1"></a>**Parse Date Variable** <span class="in">`post_created`</span></span>
<span id="cb92-114"><a href="#cb92-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-117"><a href="#cb92-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-118"><a href="#cb92-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the timezone offset from the date string</span></span>
<span id="cb92-119"><a href="#cb92-119" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">+</span><span class="sc">\\</span><span class="st">d{4}"</span>, <span class="st">""</span>, mental<span class="sc">$</span>post_created)</span>
<span id="cb92-120"><a href="#cb92-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-121"><a href="#cb92-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-124"><a href="#cb92-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-125"><a href="#cb92-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the date string to a date variable</span></span>
<span id="cb92-126"><a href="#cb92-126" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>date_any <span class="ot">&lt;-</span> <span class="fu">anytime</span>(mental<span class="sc">$</span>date)</span>
<span id="cb92-127"><a href="#cb92-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-128"><a href="#cb92-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the date variable as "YYYY-MM-DD H:M"</span></span>
<span id="cb92-129"><a href="#cb92-129" aria-hidden="true" tabindex="-1"></a><span class="co">#mental$formatted_date &lt;- format(mental$date_any , "%Y-%m-%d %H:%M")</span></span>
<span id="cb92-130"><a href="#cb92-130" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>formatted_date <span class="ot">&lt;-</span> <span class="fu">format</span>(mental<span class="sc">$</span>date_any , <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb92-131"><a href="#cb92-131" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>day_hour <span class="ot">&lt;-</span> <span class="fu">format</span>(mental<span class="sc">$</span>date_any, <span class="st">"%Y-%m-%d %H"</span>)</span>
<span id="cb92-132"><a href="#cb92-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-133"><a href="#cb92-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-134"><a href="#cb92-134" aria-hidden="true" tabindex="-1"></a><span class="in">`Formatted_date`</span> is a <span class="in">`character`</span> class. When we would use <span class="in">`as.Date()`</span> we would lose the <span class="in">`timestamp`</span> information. When we have a character with both date and time we have to use <span class="in">`POSIXct`</span> class (as seen with the <span class="in">`date_any`</span> variable).</span>
<span id="cb92-135"><a href="#cb92-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-138"><a href="#cb92-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-139"><a href="#cb92-139" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(mental<span class="sc">$</span>formatted_date)</span>
<span id="cb92-140"><a href="#cb92-140" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>date_hour <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(mental<span class="sc">$</span>day_hour)</span>
<span id="cb92-141"><a href="#cb92-141" aria-hidden="true" tabindex="-1"></a><span class="co">#mental$formatted_date_time &lt;- as.POSIXlt(mental$formatted_date)</span></span>
<span id="cb92-142"><a href="#cb92-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-143"><a href="#cb92-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-144"><a href="#cb92-144" aria-hidden="true" tabindex="-1"></a>mental <span class="sc">%&gt;%</span></span>
<span id="cb92-145"><a href="#cb92-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-146"><a href="#cb92-146" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate how many tweets posted on each date</span></span>
<span id="cb92-147"><a href="#cb92-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb92-148"><a href="#cb92-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-149"><a href="#cb92-149" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the result</span></span>
<span id="cb92-150"><a href="#cb92-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb92-151"><a href="#cb92-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb92-152"><a href="#cb92-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb92-153"><a href="#cb92-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"7 day"</span>, <span class="at">date_labels =</span> <span class="st">"%b %d"</span>) <span class="sc">+</span></span>
<span id="cb92-154"><a href="#cb92-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Number of Tweets</span><span class="sc">\n</span><span class="st">"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Date"</span>)</span>
<span id="cb92-155"><a href="#cb92-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-156"><a href="#cb92-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-157"><a href="#cb92-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-158"><a href="#cb92-158" aria-hidden="true" tabindex="-1"></a>**Distribution Friends**</span>
<span id="cb92-159"><a href="#cb92-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-160"><a href="#cb92-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb92-161"><a href="#cb92-161" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>logfriends <span class="ot">&lt;-</span><span class="fu">log</span>(mental<span class="sc">$</span>friends<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb92-162"><a href="#cb92-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-163"><a href="#cb92-163" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mental<span class="sc">$</span>logfriends,  <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">prob=</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-164"><a href="#cb92-164" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mental<span class="sc">$</span>logfriends), <span class="at">col =</span> <span class="st">"red"</span>)  </span>
<span id="cb92-165"><a href="#cb92-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-166"><a href="#cb92-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-167"><a href="#cb92-167" aria-hidden="true" tabindex="-1"></a>**Distribution Followers**</span>
<span id="cb92-168"><a href="#cb92-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-169"><a href="#cb92-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Log transformed followers}</span></span>
<span id="cb92-170"><a href="#cb92-170" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>logfollow<span class="ot">=</span><span class="fu">log</span>(mental<span class="sc">$</span>followers<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb92-171"><a href="#cb92-171" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mental<span class="sc">$</span>logfollow, <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">prob =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-172"><a href="#cb92-172" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mental<span class="sc">$</span>logfollow), <span class="at">col =</span> <span class="st">"red"</span>)   </span>
<span id="cb92-173"><a href="#cb92-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-174"><a href="#cb92-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-177"><a href="#cb92-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-178"><a href="#cb92-178" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mental, <span class="fu">aes</span>(<span class="at">x =</span> logfriends, <span class="at">y =</span> logfollow)) <span class="sc">+</span> </span>
<span id="cb92-179"><a href="#cb92-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">5</span>)</span>
<span id="cb92-180"><a href="#cb92-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-181"><a href="#cb92-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-182"><a href="#cb92-182" aria-hidden="true" tabindex="-1"></a>**Tweets und Retweets per day**</span>
<span id="cb92-183"><a href="#cb92-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-184"><a href="#cb92-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb92-185"><a href="#cb92-185" aria-hidden="true" tabindex="-1"></a>twt_retwt_summary <span class="ot">&lt;-</span> mental <span class="sc">%&gt;%</span></span>
<span id="cb92-186"><a href="#cb92-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id, date, label) <span class="sc">%&gt;%</span></span>
<span id="cb92-187"><a href="#cb92-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tweets =</span> <span class="fu">n</span>(),</span>
<span id="cb92-188"><a href="#cb92-188" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_retweets =</span> <span class="fu">exp</span>(<span class="fu">mean</span>(<span class="fu">log</span>(retweets <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb92-189"><a href="#cb92-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-190"><a href="#cb92-190" aria-hidden="true" tabindex="-1"></a>startTime <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2014-01-01"</span>)</span>
<span id="cb92-191"><a href="#cb92-191" aria-hidden="true" tabindex="-1"></a>endTime <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2017-10-31"</span>)</span>
<span id="cb92-192"><a href="#cb92-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-193"><a href="#cb92-193" aria-hidden="true" tabindex="-1"></a><span class="co"># create a start and end time R object</span></span>
<span id="cb92-194"><a href="#cb92-194" aria-hidden="true" tabindex="-1"></a>start.end <span class="ot">&lt;-</span> <span class="fu">c</span>(startTime,endTime)</span>
<span id="cb92-195"><a href="#cb92-195" aria-hidden="true" tabindex="-1"></a>start.end</span>
<span id="cb92-196"><a href="#cb92-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-197"><a href="#cb92-197" aria-hidden="true" tabindex="-1"></a>pl1 <span class="ot">&lt;-</span> twt_retwt_summary <span class="sc">%&gt;%</span></span>
<span id="cb92-198"><a href="#cb92-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, tweets, <span class="at">group =</span> user_id, <span class="at">fill=</span> user_id)) <span class="sc">+</span></span>
<span id="cb92-199"><a href="#cb92-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">size =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb92-200"><a href="#cb92-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb92-201"><a href="#cb92-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb92-202"><a href="#cb92-202" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of depression tweets per day"</span>) <span class="sc">+</span></span>
<span id="cb92-203"><a href="#cb92-203" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">scale_x_date</span>(<span class="at">limits=</span>start.end,</span>
<span id="cb92-204"><a href="#cb92-204" aria-hidden="true" tabindex="-1"></a>                             <span class="at">breaks=</span><span class="fu">date_breaks</span>(<span class="st">"3 month"</span>),</span>
<span id="cb92-205"><a href="#cb92-205" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels=</span><span class="fu">date_format</span>(<span class="st">"%b %y"</span>)))</span>
<span id="cb92-206"><a href="#cb92-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-207"><a href="#cb92-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-208"><a href="#cb92-208" aria-hidden="true" tabindex="-1"></a>twt_retwt_summary <span class="sc">%&gt;%</span></span>
<span id="cb92-209"><a href="#cb92-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, tweets, <span class="at">group =</span> user_id, <span class="at">fill=</span> label, <span class="at">col=</span> label)) <span class="sc">+</span></span>
<span id="cb92-210"><a href="#cb92-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">size =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb92-211"><a href="#cb92-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb92-212"><a href="#cb92-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb92-213"><a href="#cb92-213" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of depression tweets per day"</span>) <span class="sc">+</span></span>
<span id="cb92-214"><a href="#cb92-214" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">scale_x_date</span>(<span class="at">limits=</span>start.end,</span>
<span id="cb92-215"><a href="#cb92-215" aria-hidden="true" tabindex="-1"></a>                             <span class="at">breaks=</span><span class="fu">date_breaks</span>(<span class="st">"3 month"</span>),</span>
<span id="cb92-216"><a href="#cb92-216" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels=</span><span class="fu">date_format</span>(<span class="st">"%b %y"</span>)))</span>
<span id="cb92-217"><a href="#cb92-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-218"><a href="#cb92-218" aria-hidden="true" tabindex="-1"></a>twt_retwt_summary <span class="sc">%&gt;%</span></span>
<span id="cb92-219"><a href="#cb92-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, avg_retweets, <span class="at">group =</span> user_id, <span class="at">fill=</span> label, <span class="at">col=</span> label)) <span class="sc">+</span></span>
<span id="cb92-220"><a href="#cb92-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">size =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb92-221"><a href="#cb92-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb92-222"><a href="#cb92-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb92-223"><a href="#cb92-223" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of depression tweets per day"</span>) <span class="sc">+</span></span>
<span id="cb92-224"><a href="#cb92-224" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">scale_x_date</span>(<span class="at">limits=</span>start.end,</span>
<span id="cb92-225"><a href="#cb92-225" aria-hidden="true" tabindex="-1"></a>                             <span class="at">breaks=</span><span class="fu">date_breaks</span>(<span class="st">"3 month"</span>),</span>
<span id="cb92-226"><a href="#cb92-226" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels=</span><span class="fu">date_format</span>(<span class="st">"%b %y"</span>)))</span>
<span id="cb92-227"><a href="#cb92-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-228"><a href="#cb92-228" aria-hidden="true" tabindex="-1"></a>pl2 <span class="ot">&lt;-</span>twt_retwt_summary <span class="sc">%&gt;%</span></span>
<span id="cb92-229"><a href="#cb92-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, avg_retweets, <span class="at">group=</span>user_id)) <span class="sc">+</span></span>
<span id="cb92-230"><a href="#cb92-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">size =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb92-231"><a href="#cb92-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb92-232"><a href="#cb92-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb92-233"><a href="#cb92-233" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average (geometric mean) retweets each day"</span>)<span class="sc">+</span></span>
<span id="cb92-234"><a href="#cb92-234" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">scale_x_date</span>(<span class="at">limits=</span>start.end,</span>
<span id="cb92-235"><a href="#cb92-235" aria-hidden="true" tabindex="-1"></a>                             <span class="at">breaks=</span><span class="fu">date_breaks</span>(<span class="st">"3 month"</span>),</span>
<span id="cb92-236"><a href="#cb92-236" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels=</span><span class="fu">date_format</span>(<span class="st">"%b %y"</span>)))</span>
<span id="cb92-237"><a href="#cb92-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-238"><a href="#cb92-238" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(pl1,pl2, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb92-239"><a href="#cb92-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-240"><a href="#cb92-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-241"><a href="#cb92-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE, message=FALSE}</span></span>
<span id="cb92-242"><a href="#cb92-242" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(twt_retwt_summary<span class="sc">$</span>tweets)</span>
<span id="cb92-243"><a href="#cb92-243" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(twt_retwt_summary<span class="sc">$</span>avg_retweets)</span>
<span id="cb92-244"><a href="#cb92-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-245"><a href="#cb92-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-246"><a href="#cb92-246" aria-hidden="true" tabindex="-1"></a>**User Activity**</span>
<span id="cb92-247"><a href="#cb92-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-248"><a href="#cb92-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE, message=FALSE}</span></span>
<span id="cb92-249"><a href="#cb92-249" aria-hidden="true" tabindex="-1"></a>mental <span class="sc">%&gt;%</span></span>
<span id="cb92-250"><a href="#cb92-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(user_id, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-251"><a href="#cb92-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-252"><a href="#cb92-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">username =</span> <span class="fu">reorder</span>(user_id, n)) <span class="sc">%&gt;%</span></span>
<span id="cb92-253"><a href="#cb92-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(username, n)) <span class="sc">+</span></span>
<span id="cb92-254"><a href="#cb92-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb92-255"><a href="#cb92-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb92-256"><a href="#cb92-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-257"><a href="#cb92-257" aria-hidden="true" tabindex="-1"></a><span class="co">#Retweet activity per user</span></span>
<span id="cb92-258"><a href="#cb92-258" aria-hidden="true" tabindex="-1"></a>mental <span class="sc">%&gt;%</span></span>
<span id="cb92-259"><a href="#cb92-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(retweets)) <span class="sc">%&gt;%</span></span>
<span id="cb92-260"><a href="#cb92-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_id, post_text, retweets)</span>
<span id="cb92-261"><a href="#cb92-261" aria-hidden="true" tabindex="-1"></a><span class="co">#Tweets und Retweets per User</span></span>
<span id="cb92-262"><a href="#cb92-262" aria-hidden="true" tabindex="-1"></a>mental <span class="sc">%&gt;%</span></span>
<span id="cb92-263"><a href="#cb92-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">%&gt;%</span></span>
<span id="cb92-264"><a href="#cb92-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tweets =</span> <span class="fu">n</span>(),</span>
<span id="cb92-265"><a href="#cb92-265" aria-hidden="true" tabindex="-1"></a>            <span class="at">retweetnr =</span> <span class="fu">sum</span>(retweets)) <span class="sc">%&gt;%</span></span>
<span id="cb92-266"><a href="#cb92-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tweets)) <span class="sc">%&gt;%</span></span>
<span id="cb92-267"><a href="#cb92-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(retweetnr))</span>
<span id="cb92-268"><a href="#cb92-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-269"><a href="#cb92-269" aria-hidden="true" tabindex="-1"></a><span class="co">#Proportion Likes and Retweets per User</span></span>
<span id="cb92-270"><a href="#cb92-270" aria-hidden="true" tabindex="-1"></a>mental <span class="sc">%&gt;%</span></span>
<span id="cb92-271"><a href="#cb92-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_id, post_text, retweets, favourites) <span class="sc">%&gt;%</span></span>
<span id="cb92-272"><a href="#cb92-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ratio =</span> (favourites <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (retweets <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="co"># to avoid zero</span></span>
<span id="cb92-273"><a href="#cb92-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ratio))</span>
<span id="cb92-274"><a href="#cb92-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-275"><a href="#cb92-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-276"><a href="#cb92-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-277"><a href="#cb92-277" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 8. Basics Text Mining in a Nutshell</span></span>
<span id="cb92-278"><a href="#cb92-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-279"><a href="#cb92-279" aria-hidden="true" tabindex="-1"></a>A.**Document** = collection of strings and their metadata</span>
<span id="cb92-280"><a href="#cb92-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-281"><a href="#cb92-281" aria-hidden="true" tabindex="-1"></a>B.**Corpus** = collection of <span class="sc">\*</span>documents<span class="sc">\*\*</span>.</span>
<span id="cb92-282"><a href="#cb92-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-283"><a href="#cb92-283" aria-hidden="true" tabindex="-1"></a>C.**Tokens** = smallest unit of meaning (mostly words)</span>
<span id="cb92-284"><a href="#cb92-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-285"><a href="#cb92-285" aria-hidden="true" tabindex="-1"></a>D.**Vocabulary** = collection of unique words of a *Corpus*.</span>
<span id="cb92-286"><a href="#cb92-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-287"><a href="#cb92-287" aria-hidden="true" tabindex="-1"></a>E.**D**ocument-**F**eature-**M**atrix or **D**ocument-**T**erm-**M**atrix =</span>
<span id="cb92-288"><a href="#cb92-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-289"><a href="#cb92-289" aria-hidden="true" tabindex="-1"></a>this is a matrix where the rows indicate the documents, the columns indicate the expressions and the cells indicate the frequency of the expressions in each document, i.e.: Matrix with *n* = number of Document rows and *m* = size of Vocabulary columns, based on **bag-of-words** assumption, which ignores word order and syntax.</span>
<span id="cb92-290"><a href="#cb92-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-291"><a href="#cb92-291" aria-hidden="true" tabindex="-1"></a><span class="fu">##### 8.1. Pre-processing</span></span>
<span id="cb92-292"><a href="#cb92-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-293"><a href="#cb92-293" aria-hidden="true" tabindex="-1"></a>A. **Tokenisation**</span>
<span id="cb92-294"><a href="#cb92-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-295"><a href="#cb92-295" aria-hidden="true" tabindex="-1"></a>B. **Remove** Stopwords</span>
<span id="cb92-296"><a href="#cb92-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-297"><a href="#cb92-297" aria-hidden="true" tabindex="-1"></a>C. **String** operations (punctuation, normalise URL).</span>
<span id="cb92-298"><a href="#cb92-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-299"><a href="#cb92-299" aria-hidden="true" tabindex="-1"></a>The order of the application steps is crucial and should be guided by the research question.</span>
<span id="cb92-300"><a href="#cb92-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-301"><a href="#cb92-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Pre-processing Punctuation}</span></span>
<span id="cb92-302"><a href="#cb92-302" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean @-Symbol</span></span>
<span id="cb92-303"><a href="#cb92-303" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>post_text<span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"@</span><span class="sc">\\</span><span class="st">w+"</span>, <span class="st">""</span>, mental<span class="sc">$</span>post_text)</span>
<span id="cb92-304"><a href="#cb92-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-305"><a href="#cb92-305" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean Interpunction</span></span>
<span id="cb92-306"><a href="#cb92-306" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>post_text<span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[[:punct:]]"</span>, <span class="st">""</span>, mental<span class="sc">$</span>post_text)</span>
<span id="cb92-307"><a href="#cb92-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-308"><a href="#cb92-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean Numbers</span></span>
<span id="cb92-309"><a href="#cb92-309" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>post_text <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[[:digit:]]"</span>, <span class="st">""</span>, mental<span class="sc">$</span>post_text)</span>
<span id="cb92-310"><a href="#cb92-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-311"><a href="#cb92-311" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean pictures</span></span>
<span id="cb92-312"><a href="#cb92-312" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>post_text<span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"pictwitter</span><span class="sc">\\</span><span class="st">w+ *"</span>, <span class="st">""</span>, mental<span class="sc">$</span>post_text)</span>
<span id="cb92-313"><a href="#cb92-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-314"><a href="#cb92-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-315"><a href="#cb92-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Pre-processing html}</span></span>
<span id="cb92-316"><a href="#cb92-316" aria-hidden="true" tabindex="-1"></a><span class="co">#Clean HTML-Notation</span></span>
<span id="cb92-317"><a href="#cb92-317" aria-hidden="true" tabindex="-1"></a>remove_html <span class="ot">&lt;-</span> <span class="st">"&amp;amp;|&amp;lt;|&amp;gt;"</span> <span class="co">#&amp;lt und &amp;gt stehen f√ºr &lt; und &gt; und &amp;amp f√ºr &amp;</span></span>
<span id="cb92-318"><a href="#cb92-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-319"><a href="#cb92-319" aria-hidden="true" tabindex="-1"></a>mental_en <span class="ot">&lt;-</span> mental <span class="sc">%&gt;%</span> </span>
<span id="cb92-320"><a href="#cb92-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(post_id, post_text, user_id) <span class="sc">%&gt;%</span> </span>
<span id="cb92-321"><a href="#cb92-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(post_text, remove_html))</span>
<span id="cb92-322"><a href="#cb92-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-323"><a href="#cb92-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-324"><a href="#cb92-324" aria-hidden="true" tabindex="-1"></a>With <span class="co">[</span><span class="ot">`textclean`</span><span class="co">](https://github.com/trinker/textclean)</span> further harmonisation can be done, e.g. replacing emojis with word equivalents.</span>
<span id="cb92-325"><a href="#cb92-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-326"><a href="#cb92-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb92-327"><a href="#cb92-327" aria-hidden="true" tabindex="-1"></a>mental_en<span class="sc">$</span>text <span class="ot">&lt;-</span> <span class="fu">replace_emoji</span>(mental_en<span class="sc">$</span>text)</span>
<span id="cb92-328"><a href="#cb92-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-329"><a href="#cb92-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-330"><a href="#cb92-330" aria-hidden="true" tabindex="-1"></a>Or normalizing colloquial expressions such as word elongations (e.g., "Whyyyy")</span>
<span id="cb92-331"><a href="#cb92-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-332"><a href="#cb92-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb92-333"><a href="#cb92-333" aria-hidden="true" tabindex="-1"></a>mental_en<span class="sc">$</span>text <span class="ot">&lt;-</span> <span class="fu">replace_word_elongation</span>(mental_en<span class="sc">$</span>text)</span>
<span id="cb92-334"><a href="#cb92-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-335"><a href="#cb92-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-336"><a href="#cb92-336" aria-hidden="true" tabindex="-1"></a>From the data frame, you can create a *Corpus* object, i.e. a collection of *documents* (tweets) and their *metadata*.</span>
<span id="cb92-337"><a href="#cb92-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-340"><a href="#cb92-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-341"><a href="#cb92-341" aria-hidden="true" tabindex="-1"></a><span class="co">#select unique tweet_ids</span></span>
<span id="cb92-342"><a href="#cb92-342" aria-hidden="true" tabindex="-1"></a>unique <span class="ot">&lt;-</span> mental_en <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(post_id) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb92-343"><a href="#cb92-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-344"><a href="#cb92-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-345"><a href="#cb92-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Corpus Objekt, results='hide'}</span></span>
<span id="cb92-346"><a href="#cb92-346" aria-hidden="true" tabindex="-1"></a>tweets_en_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(unique,</span>
<span id="cb92-347"><a href="#cb92-347" aria-hidden="true" tabindex="-1"></a>                           <span class="at">docid_field =</span> <span class="st">"post_id"</span>,</span>
<span id="cb92-348"><a href="#cb92-348" aria-hidden="true" tabindex="-1"></a>                           <span class="at">text_field =</span> <span class="st">"post_text"</span>)</span>
<span id="cb92-349"><a href="#cb92-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-350"><a href="#cb92-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-351"><a href="#cb92-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-352"><a href="#cb92-352" aria-hidden="true" tabindex="-1"></a>In <span class="in">`quanteda`</span> the smallest meaningful unit are **tokens** which can be generated by segmenting into words (see `tidytext` `unnest_tokens(word, text)`. Further, we can remove **stopwords** (hedges, grammatical signifiers which bear little semantic meaning). See (<span class="in">`stopwords()`</span>)</span>
<span id="cb92-353"><a href="#cb92-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-354"><a href="#cb92-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Tokenisation, results=FALSE}</span></span>
<span id="cb92-355"><a href="#cb92-355" aria-hidden="true" tabindex="-1"></a>tweets_en_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(tweets_en_corpus,</span>
<span id="cb92-356"><a href="#cb92-356" aria-hidden="true" tabindex="-1"></a>                           <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb92-357"><a href="#cb92-357" aria-hidden="true" tabindex="-1"></a>                           <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb92-358"><a href="#cb92-358" aria-hidden="true" tabindex="-1"></a>                           <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb92-359"><a href="#cb92-359" aria-hidden="true" tabindex="-1"></a>                           <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-360"><a href="#cb92-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb92-361"><a href="#cb92-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(<span class="fu">stopwords</span>(<span class="st">"english"</span>))</span>
<span id="cb92-362"><a href="#cb92-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-363"><a href="#cb92-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-364"><a href="#cb92-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r KWIC, results='hide'}</span></span>
<span id="cb92-365"><a href="#cb92-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-366"><a href="#cb92-366" aria-hidden="true" tabindex="-1"></a>kw_depression <span class="ot">&lt;-</span> <span class="fu">kwic</span>(tweets_en_tokens, <span class="at">pattern =</span>  <span class="st">"depress*"</span>, <span class="at">window =</span> <span class="dv">3</span>)</span>
<span id="cb92-367"><a href="#cb92-367" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(kw_depression)</span>
<span id="cb92-368"><a href="#cb92-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-369"><a href="#cb92-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-370"><a href="#cb92-370" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 8.2. Tidy Workflow--Exploration Tweets, Retweets and Hashtags</span></span>
<span id="cb92-371"><a href="#cb92-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-372"><a href="#cb92-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Tokenisation und Pre-processing}</span></span>
<span id="cb92-373"><a href="#cb92-373" aria-hidden="true" tabindex="-1"></a><span class="co">#Tokenising Tweets (1-gram) and Pre-processing with tidytext</span></span>
<span id="cb92-374"><a href="#cb92-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-375"><a href="#cb92-375" aria-hidden="true" tabindex="-1"></a>tweet_words <span class="ot">&lt;-</span> mental <span class="sc">%&gt;%</span></span>
<span id="cb92-376"><a href="#cb92-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_id, </span>
<span id="cb92-377"><a href="#cb92-377" aria-hidden="true" tabindex="-1"></a>         post_text, </span>
<span id="cb92-378"><a href="#cb92-378" aria-hidden="true" tabindex="-1"></a>         retweets, </span>
<span id="cb92-379"><a href="#cb92-379" aria-hidden="true" tabindex="-1"></a>         favourites,</span>
<span id="cb92-380"><a href="#cb92-380" aria-hidden="true" tabindex="-1"></a>         formatted_date, </span>
<span id="cb92-381"><a href="#cb92-381" aria-hidden="true" tabindex="-1"></a>         post_id) <span class="sc">%&gt;%</span></span>
<span id="cb92-382"><a href="#cb92-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, post_text) <span class="sc">%&gt;%</span></span>
<span id="cb92-383"><a href="#cb92-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-384"><a href="#cb92-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"amp"</span>, <span class="st">"de"</span>, <span class="st">"twitter"</span>, <span class="st">"youre"</span>, <span class="st">"en"</span>, <span class="st">"die"</span>, <span class="st">"rt"</span>, <span class="st">"im"</span>, <span class="st">"dont"</span>, <span class="st">"ive"</span>, <span class="st">"yong"</span>),</span>
<span id="cb92-385"><a href="#cb92-385" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_detect</span>(word, <span class="st">"[a-z]"</span>))</span>
<span id="cb92-386"><a href="#cb92-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-387"><a href="#cb92-387" aria-hidden="true" tabindex="-1"></a>tweet_words <span class="sc">%&gt;%</span></span>
<span id="cb92-388"><a href="#cb92-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-389"><a href="#cb92-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-390"><a href="#cb92-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">reorder</span>(word, n)) <span class="sc">%&gt;%</span></span>
<span id="cb92-391"><a href="#cb92-391" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(word, n)) <span class="sc">+</span></span>
<span id="cb92-392"><a href="#cb92-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb92-393"><a href="#cb92-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb92-394"><a href="#cb92-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most common words in Tweets on Depression"</span>,</span>
<span id="cb92-395"><a href="#cb92-395" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency of words"</span>)</span>
<span id="cb92-396"><a href="#cb92-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-397"><a href="#cb92-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-398"><a href="#cb92-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-399"><a href="#cb92-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Favorites und Retweets, warning=FALSE, message=FALSE}</span></span>
<span id="cb92-400"><a href="#cb92-400" aria-hidden="true" tabindex="-1"></a><span class="co">#Distribution of Favorites</span></span>
<span id="cb92-401"><a href="#cb92-401" aria-hidden="true" tabindex="-1"></a>mental <span class="sc">%&gt;%</span></span>
<span id="cb92-402"><a href="#cb92-402" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(favourites <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb92-403"><a href="#cb92-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb92-404"><a href="#cb92-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span>
<span id="cb92-405"><a href="#cb92-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-406"><a href="#cb92-406" aria-hidden="true" tabindex="-1"></a><span class="co">#Mean Retweets and Mean Favorites</span></span>
<span id="cb92-407"><a href="#cb92-407" aria-hidden="true" tabindex="-1"></a>word_summary <span class="ot">&lt;-</span> tweet_words  <span class="sc">%&gt;%</span></span>
<span id="cb92-408"><a href="#cb92-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb92-409"><a href="#cb92-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb92-410"><a href="#cb92-410" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_retweets =</span> <span class="fu">exp</span>(<span class="fu">mean</span>(<span class="fu">log</span>(retweets <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb92-411"><a href="#cb92-411" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_favorites =</span> <span class="fu">exp</span>(<span class="fu">mean</span>(<span class="fu">log</span>(favourites <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-412"><a href="#cb92-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-413"><a href="#cb92-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_retweets))</span>
<span id="cb92-414"><a href="#cb92-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-415"><a href="#cb92-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-416"><a href="#cb92-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-417"><a href="#cb92-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tf-idf}</span></span>
<span id="cb92-418"><a href="#cb92-418" aria-hidden="true" tabindex="-1"></a><span class="co">#Tf-idf: signals importance of a word in a corpus selection</span></span>
<span id="cb92-419"><a href="#cb92-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-420"><a href="#cb92-420" aria-hidden="true" tabindex="-1"></a>top_word <span class="ot">&lt;-</span> tweet_words <span class="sc">%&gt;%</span></span>
<span id="cb92-421"><a href="#cb92-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, formatted_date) <span class="sc">%&gt;%</span></span>
<span id="cb92-422"><a href="#cb92-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(word, formatted_date, n) <span class="sc">%&gt;%</span></span>
<span id="cb92-423"><a href="#cb92-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf)) <span class="sc">%&gt;%</span></span>
<span id="cb92-424"><a href="#cb92-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(formatted_date, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-425"><a href="#cb92-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(formatted_date)</span>
<span id="cb92-426"><a href="#cb92-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-427"><a href="#cb92-427" aria-hidden="true" tabindex="-1"></a>tf_idf <span class="ot">&lt;-</span> word_summary <span class="sc">%&gt;%</span></span>
<span id="cb92-428"><a href="#cb92-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(top_word, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"word"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-429"><a href="#cb92-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_retweets)) </span>
<span id="cb92-430"><a href="#cb92-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-431"><a href="#cb92-431" aria-hidden="true" tabindex="-1"></a><span class="co">#Tf-idf of words per hour</span></span>
<span id="cb92-432"><a href="#cb92-432" aria-hidden="true" tabindex="-1"></a>tf_idf <span class="sc">%&gt;%</span> </span>
<span id="cb92-433"><a href="#cb92-433" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(tf_idf, forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(word, tf_idf), <span class="at">fill =</span> word)) <span class="sc">+</span></span>
<span id="cb92-434"><a href="#cb92-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb92-435"><a href="#cb92-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-436"><a href="#cb92-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-437"><a href="#cb92-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hashtags, warning=FALSE}</span></span>
<span id="cb92-438"><a href="#cb92-438" aria-hidden="true" tabindex="-1"></a><span class="co">#Hashtag exploration</span></span>
<span id="cb92-439"><a href="#cb92-439" aria-hidden="true" tabindex="-1"></a>tweet_words <span class="ot">&lt;-</span> mental <span class="sc">%&gt;%</span></span>
<span id="cb92-440"><a href="#cb92-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hashtags =</span> stringr<span class="sc">::</span><span class="fu">str_count</span>(post_text, <span class="st">"#[a-zA-Z]"</span>), <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-441"><a href="#cb92-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(user_id, post_text, retweets, favourites, formatted_date , post_id,</span>
<span id="cb92-442"><a href="#cb92-442" aria-hidden="true" tabindex="-1"></a>        hashtags) <span class="sc">%&gt;%</span></span>
<span id="cb92-443"><a href="#cb92-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, post_text) <span class="sc">%&gt;%</span></span>
<span id="cb92-444"><a href="#cb92-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-445"><a href="#cb92-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"de"</span>, <span class="st">"|"</span>),</span>
<span id="cb92-446"><a href="#cb92-446" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_detect</span>(word, <span class="st">"[a-z]"</span>))</span>
<span id="cb92-447"><a href="#cb92-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-448"><a href="#cb92-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-449"><a href="#cb92-449" aria-hidden="true" tabindex="-1"></a>mental <span class="sc">%&gt;%</span></span>
<span id="cb92-450"><a href="#cb92-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hashtags =</span> stringr<span class="sc">::</span><span class="fu">str_count</span>(post_text, <span class="st">"#[a-zA-Z]"</span>), <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-451"><a href="#cb92-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hashtags <span class="sc">&lt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-452"><a href="#cb92-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">%&gt;%</span></span>
<span id="cb92-453"><a href="#cb92-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tweets =</span> <span class="fu">n</span>(),</span>
<span id="cb92-454"><a href="#cb92-454" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_retweets =</span> <span class="fu">exp</span>(<span class="fu">mean</span>(<span class="fu">log</span>(retweets <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-455"><a href="#cb92-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tweets <span class="sc">&gt;=</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-456"><a href="#cb92-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_retweets))</span>
<span id="cb92-457"><a href="#cb92-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-458"><a href="#cb92-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-459"><a href="#cb92-459" aria-hidden="true" tabindex="-1"></a>tweet_word_summary <span class="ot">&lt;-</span> tweet_words <span class="sc">%&gt;%</span></span>
<span id="cb92-460"><a href="#cb92-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hashtags <span class="sc">&lt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-461"><a href="#cb92-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb92-462"><a href="#cb92-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb92-463"><a href="#cb92-463" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_retweets =</span> <span class="fu">exp</span>(<span class="fu">mean</span>(<span class="fu">log</span>(retweets<span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb92-464"><a href="#cb92-464" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_favorites =</span> <span class="fu">exp</span>(<span class="fu">mean</span>(<span class="fu">log</span>(favourites <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb92-465"><a href="#cb92-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-466"><a href="#cb92-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-467"><a href="#cb92-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-468"><a href="#cb92-468" aria-hidden="true" tabindex="-1"></a>tweet_word_summary <span class="ot">&lt;-</span>tweet_word_summary <span class="sc">%&gt;%</span></span>
<span id="cb92-469"><a href="#cb92-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">100</span>,</span>
<span id="cb92-470"><a href="#cb92-470" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(word, <span class="st">"https"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-471"><a href="#cb92-471" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span>word <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"amp"</span>, <span class="st">"de"</span>, <span class="st">"twitter"</span>, <span class="st">"youre"</span>, <span class="st">"en"</span>, <span class="st">"die"</span>, <span class="st">"rt"</span>, <span class="st">"im"</span>, <span class="st">"dont"</span>, <span class="st">"ive"</span>, <span class="st">"yong"</span>),</span>
<span id="cb92-472"><a href="#cb92-472" aria-hidden="true" tabindex="-1"></a>         stringr<span class="sc">::</span><span class="fu">str_detect</span>(word, <span class="st">"[a-z]"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-473"><a href="#cb92-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_retweets)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-474"><a href="#cb92-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb92-475"><a href="#cb92-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-476"><a href="#cb92-476" aria-hidden="true" tabindex="-1"></a>tweet_word_summary <span class="sc">%&gt;%</span></span>
<span id="cb92-477"><a href="#cb92-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">100</span>,</span>
<span id="cb92-478"><a href="#cb92-478" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(word, <span class="st">"https"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-479"><a href="#cb92-479" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(n, avg_retweets)) <span class="sc">+</span></span>
<span id="cb92-480"><a href="#cb92-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb92-481"><a href="#cb92-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> word), <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb92-482"><a href="#cb92-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb92-483"><a href="#cb92-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span>
<span id="cb92-484"><a href="#cb92-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-485"><a href="#cb92-485" aria-hidden="true" tabindex="-1"></a>tweet_word_summary <span class="sc">%&gt;%</span></span>
<span id="cb92-486"><a href="#cb92-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">100</span>,</span>
<span id="cb92-487"><a href="#cb92-487" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(word, <span class="st">"https"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-488"><a href="#cb92-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_retweets)) <span class="sc">%&gt;%</span></span>
<span id="cb92-489"><a href="#cb92-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-490"><a href="#cb92-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">reorder</span>(word, avg_retweets)) <span class="sc">%&gt;%</span></span>
<span id="cb92-491"><a href="#cb92-491" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(word, avg_retweets)) <span class="sc">+</span></span>
<span id="cb92-492"><a href="#cb92-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb92-493"><a href="#cb92-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb92-494"><a href="#cb92-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Which words get the most retweets in depression?"</span>,</span>
<span id="cb92-495"><a href="#cb92-495" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Only words appearing in at least 100 tweets"</span>,</span>
<span id="cb92-496"><a href="#cb92-496" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Geometric mean of the Number of retweets"</span>)</span>
<span id="cb92-497"><a href="#cb92-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-498"><a href="#cb92-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-499"><a href="#cb92-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-500"><a href="#cb92-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-501"><a href="#cb92-501" aria-hidden="true" tabindex="-1"></a><span class="fu"># Predicting depression tweets based on followers and friends</span></span>
<span id="cb92-502"><a href="#cb92-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE, message=FALSE}</span></span>
<span id="cb92-503"><a href="#cb92-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-504"><a href="#cb92-504" aria-hidden="true" tabindex="-1"></a><span class="co"># Data preprocessing</span></span>
<span id="cb92-505"><a href="#cb92-505" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb92-506"><a href="#cb92-506" aria-hidden="true" tabindex="-1"></a>missing_values <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(mental))</span>
<span id="cb92-507"><a href="#cb92-507" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (missing_values <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb92-508"><a href="#cb92-508" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(mental)  <span class="co"># Remove rows with missing values</span></span>
<span id="cb92-509"><a href="#cb92-509" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-510"><a href="#cb92-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-511"><a href="#cb92-511" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert label variable to factor</span></span>
<span id="cb92-512"><a href="#cb92-512" aria-hidden="true" tabindex="-1"></a><span class="co">#mental$label &lt;- as.factor(mental$label)</span></span>
<span id="cb92-513"><a href="#cb92-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-514"><a href="#cb92-514" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize the followers and friends variables</span></span>
<span id="cb92-515"><a href="#cb92-515" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>followers_standardized <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(mental<span class="sc">$</span>followers))</span>
<span id="cb92-516"><a href="#cb92-516" aria-hidden="true" tabindex="-1"></a>mental<span class="sc">$</span>friends_standardized <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(mental<span class="sc">$</span>friends))</span>
<span id="cb92-517"><a href="#cb92-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-518"><a href="#cb92-518" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the standardized variables</span></span>
<span id="cb92-519"><a href="#cb92-519" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mental[, <span class="fu">c</span>(<span class="st">"followers"</span>, <span class="st">"followers_standardized"</span>, <span class="st">"friends"</span>, <span class="st">"friends_standardized"</span>)])</span>
<span id="cb92-520"><a href="#cb92-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-521"><a href="#cb92-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-522"><a href="#cb92-522" aria-hidden="true" tabindex="-1"></a><span class="co"># Select variables for analysis</span></span>
<span id="cb92-523"><a href="#cb92-523" aria-hidden="true" tabindex="-1"></a>selected_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"label"</span>, <span class="st">"followers_standardized"</span>, <span class="st">"friends_standardized"</span>)</span>
<span id="cb92-524"><a href="#cb92-524" aria-hidden="true" tabindex="-1"></a>mental_selected <span class="ot">&lt;-</span> mental[selected_vars]</span>
<span id="cb92-525"><a href="#cb92-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-526"><a href="#cb92-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-527"><a href="#cb92-527" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the dataset into training and testing sets</span></span>
<span id="cb92-528"><a href="#cb92-528" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># Set a seed for reproducibility</span></span>
<span id="cb92-529"><a href="#cb92-529" aria-hidden="true" tabindex="-1"></a>train_indices <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(mental_selected<span class="sc">$</span>label, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb92-530"><a href="#cb92-530" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> mental_selected[train_indices, ]</span>
<span id="cb92-531"><a href="#cb92-531" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> mental_selected[<span class="sc">-</span>train_indices, ]</span>
<span id="cb92-532"><a href="#cb92-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-533"><a href="#cb92-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-534"><a href="#cb92-534" aria-hidden="true" tabindex="-1"></a>train_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(train_data<span class="sc">$</span>label)</span>
<span id="cb92-535"><a href="#cb92-535" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data<span class="sc">$</span>label)</span>
<span id="cb92-536"><a href="#cb92-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-537"><a href="#cb92-537" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear Regression model</span></span>
<span id="cb92-538"><a href="#cb92-538" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(label <span class="sc">~</span> followers_standardized <span class="sc">+</span> friends_standardized, <span class="at">data =</span> train_data)</span>
<span id="cb92-539"><a href="#cb92-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-540"><a href="#cb92-540" aria-hidden="true" tabindex="-1"></a><span class="co"># Model evaluation</span></span>
<span id="cb92-541"><a href="#cb92-541" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> test_data)</span>
<span id="cb92-542"><a href="#cb92-542" aria-hidden="true" tabindex="-1"></a>evaluation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">actual =</span> test_data<span class="sc">$</span>label, <span class="at">predicted =</span> predictions)</span>
<span id="cb92-543"><a href="#cb92-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-544"><a href="#cb92-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate evaluation metrics</span></span>
<span id="cb92-545"><a href="#cb92-545" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">mean</span>((evaluation<span class="sc">$</span>actual <span class="sc">-</span> evaluation<span class="sc">$</span>predicted)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb92-546"><a href="#cb92-546" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(rmse)</span>
<span id="cb92-547"><a href="#cb92-547" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> <span class="fu">cor</span>(evaluation<span class="sc">$</span>actual, evaluation<span class="sc">$</span>predicted)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb92-548"><a href="#cb92-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-549"><a href="#cb92-549" aria-hidden="true" tabindex="-1"></a><span class="co"># Print evaluation metrics</span></span>
<span id="cb92-550"><a href="#cb92-550" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean Squared Error (MSE):"</span>, rmse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb92-551"><a href="#cb92-551" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Root Mean Squared Error (RMSE):"</span>, rmse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb92-552"><a href="#cb92-552" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R-squared value:"</span>, r_squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb92-553"><a href="#cb92-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-554"><a href="#cb92-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression coefficients and p-values</span></span>
<span id="cb92-555"><a href="#cb92-555" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb92-556"><a href="#cb92-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-557"><a href="#cb92-557" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dotwhisker)</span>
<span id="cb92-558"><a href="#cb92-558" aria-hidden="true" tabindex="-1"></a><span class="fu">dwplot</span>(model)<span class="sc">+</span>  </span>
<span id="cb92-559"><a href="#cb92-559" aria-hidden="true" tabindex="-1"></a>   <span class="fu">xlab</span>(<span class="st">"Coefficient Estimate"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb92-560"><a href="#cb92-560" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,</span>
<span id="cb92-561"><a href="#cb92-561" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"grey60"</span>,</span>
<span id="cb92-562"><a href="#cb92-562" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb92-563"><a href="#cb92-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicting Depression Tweets"</span>) </span>
<span id="cb92-564"><a href="#cb92-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-565"><a href="#cb92-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-566"><a href="#cb92-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-567"><a href="#cb92-567" aria-hidden="true" tabindex="-1"></a>The followers_standardized coefficient (-0.286159) indicates that, on average, a one-standard-deviation increase in the standardized followers variable is associated with a decrease of 0.286159 units in the predicted depression label.</span>
<span id="cb92-568"><a href="#cb92-568" aria-hidden="true" tabindex="-1"></a>The friends_standardized coefficient (0.314163) indicates that, on average, a one-standard-deviation increase in the standardized friends variable is associated with an increase of 0.314163 units in the predicted depression label. All t-values are large (absolute values &gt; 2), indicating that the coefficients are significantly different from zero.</span>
<span id="cb92-569"><a href="#cb92-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-570"><a href="#cb92-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-571"><a href="#cb92-571" aria-hidden="true" tabindex="-1"></a>Overall, the regression analysis suggests that both the standardized followers and standardized friends variables have a statistically significant association with the predicted depression label. An increase in the standardized followers is associated with a decrease in the predicted depression label, while an increase in the standardized friends is associated with an increase in the predicted depression label.</span>
<span id="cb92-572"><a href="#cb92-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-573"><a href="#cb92-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-576"><a href="#cb92-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-577"><a href="#cb92-577" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a non-linear regression model</span></span>
<span id="cb92-578"><a href="#cb92-578" aria-hidden="true" tabindex="-1"></a>model_nonlinear <span class="ot">&lt;-</span> <span class="fu">nls</span>(label <span class="sc">~</span> a <span class="sc">*</span> <span class="fu">exp</span>(b <span class="sc">*</span> followers_standardized) <span class="sc">+</span> c <span class="sc">*</span> friends_standardized,</span>
<span id="cb92-579"><a href="#cb92-579" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> train_data,</span>
<span id="cb92-580"><a href="#cb92-580" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">c =</span> <span class="dv">1</span>))</span>
<span id="cb92-581"><a href="#cb92-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-582"><a href="#cb92-582" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb92-583"><a href="#cb92-583" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_nonlinear)</span>
<span id="cb92-584"><a href="#cb92-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-585"><a href="#cb92-585" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the label using the non-linear regression model</span></span>
<span id="cb92-586"><a href="#cb92-586" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>predicted_nonlinear <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_nonlinear, <span class="at">newdata =</span> test_data)</span>
<span id="cb92-587"><a href="#cb92-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-588"><a href="#cb92-588" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the non-linear regression model</span></span>
<span id="cb92-589"><a href="#cb92-589" aria-hidden="true" tabindex="-1"></a>mse_nonlinear <span class="ot">&lt;-</span> <span class="fu">mean</span>((test_data<span class="sc">$</span>label <span class="sc">-</span> test_data<span class="sc">$</span>predicted_nonlinear)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb92-590"><a href="#cb92-590" aria-hidden="true" tabindex="-1"></a>rmse_nonlinear <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mse_nonlinear)</span>
<span id="cb92-591"><a href="#cb92-591" aria-hidden="true" tabindex="-1"></a>r_squared_nonlinear <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>((test_data<span class="sc">$</span>label <span class="sc">-</span> test_data<span class="sc">$</span>predicted_nonlinear)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>((test_data<span class="sc">$</span>label <span class="sc">-</span> <span class="fu">mean</span>(test_data<span class="sc">$</span>label))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb92-592"><a href="#cb92-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-593"><a href="#cb92-593" aria-hidden="true" tabindex="-1"></a><span class="co"># Print evaluation metrics</span></span>
<span id="cb92-594"><a href="#cb92-594" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean Squared Error (MSE) - Nonlinear Regression:"</span>, mse_nonlinear, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb92-595"><a href="#cb92-595" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Root Mean Squared Error (RMSE) - Nonlinear Regression:"</span>, rmse_nonlinear, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb92-596"><a href="#cb92-596" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R-squared value - Nonlinear Regression:"</span>, r_squared_nonlinear, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb92-597"><a href="#cb92-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-598"><a href="#cb92-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-599"><a href="#cb92-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-602"><a href="#cb92-602" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-603"><a href="#cb92-603" aria-hidden="true" tabindex="-1"></a><span class="fu">dwplot</span>(model_nonlinear)<span class="sc">+</span>  </span>
<span id="cb92-604"><a href="#cb92-604" aria-hidden="true" tabindex="-1"></a>   <span class="fu">xlab</span>(<span class="st">"Coefficient Estimate"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb92-605"><a href="#cb92-605" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,</span>
<span id="cb92-606"><a href="#cb92-606" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"grey60"</span>,</span>
<span id="cb92-607"><a href="#cb92-607" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb92-608"><a href="#cb92-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicting Depression Tweets with a non-linear model"</span>) </span>
<span id="cb92-609"><a href="#cb92-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-610"><a href="#cb92-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-611"><a href="#cb92-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-612"><a href="#cb92-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-615"><a href="#cb92-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-616"><a href="#cb92-616" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gam)</span>
<span id="cb92-617"><a href="#cb92-617" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb92-618"><a href="#cb92-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-619"><a href="#cb92-619" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a non-linear regression model using GAM</span></span>
<span id="cb92-620"><a href="#cb92-620" aria-hidden="true" tabindex="-1"></a>model_gam <span class="ot">&lt;-</span> <span class="fu">gam</span>(label <span class="sc">~</span> <span class="fu">s</span>(followers_standardized) <span class="sc">+</span> <span class="fu">s</span>(friends_standardized), <span class="at">data =</span> train_data)</span>
<span id="cb92-621"><a href="#cb92-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-622"><a href="#cb92-622" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess data by removing missing values</span></span>
<span id="cb92-623"><a href="#cb92-623" aria-hidden="true" tabindex="-1"></a>complete_data <span class="ot">&lt;-</span> train_data[<span class="fu">complete.cases</span>(train_data), ]</span>
<span id="cb92-624"><a href="#cb92-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-625"><a href="#cb92-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-626"><a href="#cb92-626" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the estimated effects of the variables</span></span>
<span id="cb92-627"><a href="#cb92-627" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))  <span class="co"># Adjust the layout of the plots if desired</span></span>
<span id="cb92-628"><a href="#cb92-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-629"><a href="#cb92-629" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the estimated effect of 'followers'</span></span>
<span id="cb92-630"><a href="#cb92-630" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_gam, <span class="at">select =</span> <span class="dv">1</span>, <span class="at">se=</span><span class="cn">TRUE</span>, <span class="at">residuals =</span> <span class="cn">TRUE</span>,</span>
<span id="cb92-631"><a href="#cb92-631" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Followers"</span>, <span class="at">ylab =</span> <span class="st">"Effect of Followers on Label"</span>)</span>
<span id="cb92-632"><a href="#cb92-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-633"><a href="#cb92-633" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the estimated effect of 'friends'</span></span>
<span id="cb92-634"><a href="#cb92-634" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_gam, <span class="at">select =</span> <span class="dv">2</span>, <span class="at">se=</span><span class="cn">TRUE</span>, <span class="at">residuals =</span> <span class="cn">TRUE</span>,</span>
<span id="cb92-635"><a href="#cb92-635" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Friends"</span>, <span class="at">ylab =</span> <span class="st">"Effect of Friends on Label"</span>)</span>
<span id="cb92-636"><a href="#cb92-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-637"><a href="#cb92-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-638"><a href="#cb92-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-639"><a href="#cb92-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-642"><a href="#cb92-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-643"><a href="#cb92-643" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'gratia'</span>)</span>
<span id="cb92-644"><a href="#cb92-644" aria-hidden="true" tabindex="-1"></a><span class="co"># plot all smooths</span></span>
<span id="cb92-645"><a href="#cb92-645" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(model_gam)</span>
<span id="cb92-646"><a href="#cb92-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-647"><a href="#cb92-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-648"><a href="#cb92-648" aria-hidden="true" tabindex="-1"></a>Adding partial residuals to the plot of the estimated effects in a GAM model provides a way to assess the goodness of fit and the presence of systematic patterns in the model.</span>
<span id="cb92-649"><a href="#cb92-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-650"><a href="#cb92-650" aria-hidden="true" tabindex="-1"></a>Partial residuals are calculated by subtracting the estimated component of the model (excluding the effect of a specific variable of interest) from the observed response variable. These residuals represent the part of the response variable that is not accounted for by the model for a specific variable.</span>
<span id="cb92-651"><a href="#cb92-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-652"><a href="#cb92-652" aria-hidden="true" tabindex="-1"></a>When partial residuals are added to the plot of the estimated effects, they are typically shown as individual points or a smooth line against the corresponding variable. This allows you to visually inspect the relationship between the variable and the unexplained variation in the response variable, which can help identify any remaining patterns or trends not captured by the model.</span>
<span id="cb92-653"><a href="#cb92-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-654"><a href="#cb92-654" aria-hidden="true" tabindex="-1"></a>By examining the distribution and pattern of the partial residuals, you can assess whether the model captures the underlying structure and if there are any systematic deviations from the model's predictions. Systematic patterns in the partial residuals may indicate that the model is misspecified or that there are additional variables or nonlinear relationships that should be considered.</span>
<span id="cb92-655"><a href="#cb92-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-656"><a href="#cb92-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-659"><a href="#cb92-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-660"><a href="#cb92-660" aria-hidden="true" tabindex="-1"></a><span class="fu">draw</span>(model_gam, <span class="at">residuals =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-661"><a href="#cb92-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-662"><a href="#cb92-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-663"><a href="#cb92-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-664"><a href="#cb92-664" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>